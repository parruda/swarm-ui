<%= simple_form_for instance_template, local: true, wrapper: :tailwind, html: { data: { controller: "instance-form" } } do |f| %>
  <div class="space-y-6">
    <!-- Basic Information -->
    <div class="space-y-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Basic Information</h3>
      
      <%= f.input :name,
                  label: "Template Name",
                  placeholder: "e.g., Code Review Expert",
                  hint: "A descriptive name for your instance template",
                  wrapper: :tailwind %>
      
      <%= f.input :description,
                  as: :text,
                  label: "Description",
                  placeholder: "Describe what this instance template does...",
                  hint: "Explain the purpose and capabilities of this template",
                  wrapper: :tailwind,
                  input_html: { rows: 3 } %>
      
      <div class="space-y-2">
        <label class="text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">
          Tags <span class="text-gray-500 font-normal">(comma separated)</span>
        </label>
        <input type="text"
               name="instance_template[tags_string]"
               value="<%= instance_template.tags&.join(', ') %>"
               placeholder="e.g., frontend, react, typescript"
               class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 focus:ring-2 focus:ring-inset focus:ring-orange-600 dark:focus:ring-orange-500 sm:text-sm sm:leading-6 focus:outline-none">
        <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Tags help categorize and filter templates</p>
      </div>
    </div>

    <!-- Configuration -->
    <div class="space-y-6 pt-6 border-t border-gray-200 dark:border-gray-700">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Configuration</h3>
      
      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
        <div class="space-y-2">
          <label class="text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">
            Model <span class="text-red-500">*</span>
          </label>
          <input type="text"
                 name="instance_template[config][model]"
                 value="<%= instance_template.config['model'] %>"
                 placeholder="e.g., claude-3-5-sonnet-20241022"
                 class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 focus:ring-2 focus:ring-inset focus:ring-orange-600 dark:focus:ring-orange-500 sm:text-sm sm:leading-6 focus:outline-none">
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">The AI model to use</p>
        </div>
        
        <div class="space-y-2">
          <label class="text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">
            Provider
          </label>
          <select name="instance_template[config][provider]"
                  data-action="change->instance-form#toggleProviderFields"
                  data-instance-form-target="providerSelect"
                  class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 focus:ring-2 focus:ring-inset focus:ring-orange-600 dark:focus:ring-orange-500 sm:text-sm sm:leading-6 focus:outline-none">
            <option value="claude" <%= instance_template.config['provider'] == 'claude' ? 'selected' : '' %>>Claude</option>
            <option value="openai" <%= instance_template.config['provider'] == 'openai' ? 'selected' : '' %>>OpenAI</option>
          </select>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">The AI provider</p>
        </div>
        
        <div class="space-y-2">
          <label class="text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">
            Working Directory <span class="text-red-500">*</span>
          </label>
          <input type="text"
                 name="instance_template[config][directory]"
                 value="<%= instance_template.config['directory'] %>"
                 placeholder="e.g., ."
                 required
                 class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 focus:ring-2 focus:ring-inset focus:ring-orange-600 dark:focus:ring-orange-500 sm:text-sm sm:leading-6 font-mono focus:outline-none">
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Can be an absolute path (e.g., /home/user/project) or relative to the directory the swarm will start from (e.g., . or ./frontend)</p>
        </div>
        
        <div class="space-y-2" data-provider-field="temperature" style="<%= instance_template.config['provider'] == 'claude' ? 'display: none;' : '' %>">
          <label class="text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">
            Temperature
          </label>
          <input type="number"
                 name="instance_template[config][temperature]"
                 value="<%= instance_template.config['temperature'] %>"
                 step="0.1"
                 min="0"
                 max="2"
                 placeholder="e.g., 0.7"
                 class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 focus:ring-2 focus:ring-inset focus:ring-orange-600 dark:focus:ring-orange-500 sm:text-sm sm:leading-6 focus:outline-none">
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Response randomness (0-2)</p>
        </div>
      </div>
      
      <div class="space-y-2">
        <label class="text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">
          System Prompt <span class="text-red-500">*</span>
        </label>
        <textarea name="instance_template[config][system_prompt]"
                  rows="4"
                  placeholder="Define the behavior and capabilities of this AI instance..."
                  required
                  class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 focus:ring-2 focus:ring-inset focus:ring-orange-600 dark:focus:ring-orange-500 sm:text-sm sm:leading-6 focus:outline-none"><%= instance_template.config['system_prompt'] %></textarea>
        <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Customize the behavior of this AI instance</p>
      </div>
      
      <div class="space-y-2" data-provider-field="allowed-tools" style="<%= instance_template.config['provider'] == 'openai' ? 'display: none;' : '' %>">
        <label class="text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">
          Allowed Tools
        </label>
        <p class="text-sm text-gray-500 dark:text-gray-400">
          Select the tools this instance can use (OpenAI has access to all tools)
        </p>
        <div class="mt-3 border border-gray-200 dark:border-gray-700 rounded-md p-4 bg-gray-50 dark:bg-gray-800">
          <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3">
            <% available_tools = InstanceTemplate::AVAILABLE_TOOLS %>
            <% available_tools.each do |tool| %>
              <label class="flex items-center cursor-pointer hover:text-gray-900 dark:hover:text-gray-100">
                <input type="checkbox"
                       name="instance_template[config][allowed_tools][]"
                       value="<%= tool %>"
                       <%= 'checked' if instance_template.config['allowed_tools']&.include?(tool) %>
                       class="h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-orange-600 focus:ring-0 focus:outline-none cursor-pointer">
                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300"><%= tool %></span>
              </label>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    
    <div class="mt-8 flex items-center justify-end gap-x-6 pt-6 border-t border-gray-200 dark:border-gray-700">
      <%= link_to "Cancel", instance_templates_path, class: "inline-flex items-center px-3 py-2 text-sm font-semibold text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300 transition-colors duration-200" %>
      <%= f.submit instance_template.persisted? ? "Update Template" : "Create Template", class: "rounded-md bg-orange-600 dark:bg-orange-900 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 dark:hover:bg-orange-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600 dark:focus-visible:outline-orange-900 transition-colors duration-200" %>
    </div>
  </div>
<% end %>