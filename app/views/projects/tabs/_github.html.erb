<turbo-frame id="project-tab-content">
  <div class="space-y-6">
    <!-- GitHub Webhooks -->
    <% if @project.github_configured? %>
      <div class="bg-white dark:bg-gray-800 shadow dark:shadow-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-700 transition-colors duration-200">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-base font-semibold text-gray-900 dark:text-gray-100 flex items-center">
            <%= heroicon "globe-alt", variant: :outline, options: { class: "h-5 w-5 mr-2" } %>
            GitHub Webhooks
          </h2>
        </div>
        
        <div class="px-6 py-4">
          <% if !Setting.github_username_configured? %>
            <div class="rounded-md bg-amber-50 dark:bg-amber-900/20 p-3 mb-4">
              <div class="flex">
                <div class="flex-shrink-0">
                  <%= heroicon "exclamation-triangle", variant: :mini, options: { class: "h-4 w-4 text-amber-400" } %>
                </div>
                <div class="ml-2">
                  <p class="text-sm text-amber-700 dark:text-amber-300">
                    GitHub username not configured. <%= link_to "Configure in Settings", edit_settings_path(anchor: "github-username"), class: "font-medium underline hover:text-amber-800 dark:hover:text-amber-200" %> to enable webhooks.
                  </p>
                </div>
              </div>
            </div>
          <% end %>
          
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-900 dark:text-gray-100">
                <span class="font-medium">Status:</span>
                <span class="ml-2 inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset 
                  <%= @project.github_webhook_enabled? ? 'bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-400 ring-green-600/20 dark:ring-green-400/30' : 'bg-gray-50 dark:bg-gray-900/30 text-gray-600 dark:text-gray-400 ring-gray-600/20 dark:ring-gray-400/30' %>">
                  <% if @project.github_webhook_enabled? %>
                    <%= heroicon "check-circle", variant: :mini, options: { class: "h-3 w-3 mr-1" } %>
                    <span class="text-green-700 dark:text-green-400">Enabled</span>
                  <% else %>
                    <%= heroicon "x-circle", variant: :mini, options: { class: "h-3 w-3 mr-1" } %>
                    <span class="text-gray-600 dark:text-gray-400">Disabled</span>
                  <% end %>
                </span>
              </p>
              <% if @project.github_webhook_enabled? %>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                  Events: <%= @project.selected_event_names.join(", ") %>
                </p>
                <% if @project.webhook_commands.present? %>
                  <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                    Commands: <%= @project.webhook_commands.map { |c| c["command"] }.join(", ") %>
                    <% if @project.has_orphaned_webhook_commands? %>
                      <span class="text-yellow-600 dark:text-yellow-400">(some orphaned)</span>
                    <% end %>
                  </p>
                <% end %>
              <% end %>
            </div>
            
            <div class="flex items-center gap-3">
              <%= link_to edit_project_webhook_commands_path(@project), 
                          data: { turbo_frame: "webhook_commands_modal" },
                          class: "inline-flex items-center rounded-md bg-white dark:bg-gray-700 px-3 py-2 text-sm font-semibold text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200" do %>
                <%= heroicon "command-line", variant: :mini, options: { class: "h-4 w-4 mr-1.5" } %>
                Manage Commands
              <% end %>
              
              <%= link_to edit_project_path(@project, anchor: "webhook-configuration"), 
                          data: { turbo_frame: "_top" },
                          class: "inline-flex items-center rounded-md bg-white dark:bg-gray-700 px-3 py-2 text-sm font-semibold text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200" do %>
                <%= heroicon "cog-6-tooth", variant: :mini, options: { class: "h-4 w-4 mr-1.5" } %>
                Configure Events
              <% end %>
              
              <% has_enabled_events = @project.github_webhook_events.enabled.any? %>
              <% can_enable_webhooks = Setting.github_username_configured? && (has_enabled_events || @project.github_webhook_enabled?) %>
              
              <% if can_enable_webhooks %>
                <%= link_to toggle_webhook_project_path(@project), method: :post, data: { turbo_method: :post, turbo_frame: "project-tab-content" }, class: "inline-flex items-center rounded-md px-3 py-2 text-sm font-semibold shadow-sm transition-colors duration-200 #{@project.github_webhook_enabled? ? 'bg-red-600 hover:bg-red-500 text-white' : 'bg-orange-900 hover:bg-orange-800 text-white'}" do %>
                  <% if @project.github_webhook_enabled? %>
                    <%= heroicon "stop", variant: :mini, options: { class: "h-4 w-4 mr-1.5" } %>
                    Disable Webhooks
                  <% else %>
                    <%= heroicon "play", variant: :mini, options: { class: "h-4 w-4 mr-1.5" } %>
                    Enable Webhooks
                  <% end %>
                <% end %>
              <% else %>
                <% tooltip = !Setting.github_username_configured? ? "Configure GitHub username in Settings first" : "Select at least one event to enable webhooks" %>
                <button type="button" disabled class="inline-flex items-center rounded-md px-3 py-2 text-sm font-semibold shadow-sm bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed" title="<%= tooltip %>">
                  <%= heroicon "play", variant: :mini, options: { class: "h-4 w-4 mr-1.5" } %>
                  Enable Webhooks
                </button>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <div class="bg-white dark:bg-gray-800 shadow dark:shadow-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-700 transition-colors duration-200">
        <div class="px-6 py-8 text-center">
          <%= heroicon "link", variant: :outline, options: { class: "mx-auto h-12 w-12 text-gray-400" } %>
          <h3 class="mt-2 text-sm font-medium text-gray-900 dark:text-gray-100">GitHub Integration Not Configured</h3>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
            This project is not linked to a GitHub repository.
          </p>
          <% if @project.git? %>
            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
              Repository detected. GitHub integration will be configured automatically if this is a GitHub repository.
            </p>
          <% else %>
            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
              Initialize a Git repository and add a GitHub remote to enable webhook features.
            </p>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</turbo-frame>